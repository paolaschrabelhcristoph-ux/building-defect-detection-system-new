<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ç¼ºé™·æ£€æµ‹ - å»ºç­‘è´¨é‡æ£€æµ‹ä¸ç¼ºé™·è¯†åˆ«ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Segoe UI", "Microsoft YaHei", Arial, sans-serif;
            background: linear-gradient(135deg,
                #74b9ff 0%,
                #0984e3 25%,
                #6c5ce7 50%,
                #a29bfe 75%,
                #fd79a8 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 28px;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .upload-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px 20px;
            background: #fafafa;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .upload-area:hover {
            border-color: #4facfe;
        }

        .upload-icon {
            font-size: 60px;
            color: #4facfe;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
        }

        .upload-btn {
            background: linear-gradient(120deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.3s;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
        }

        .image-preview {
            margin-top: 20px;
            text-align: center;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin: 0 10px;
        }

        .image-comparison {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .image-container {
            text-align: center;
            margin: 10px;
            flex: 1;
            min-width: 300px;
            max-width: 50%; /* é™åˆ¶æœ€å¤§å®½åº¦ */
        }

        .image-container h4 {
            margin-bottom: 10px;
            color: #2d3436;
        }

        .image-container img {
            width: 100%;
            height: auto;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            object-fit: contain;
        }

        .defect-results {
            margin-top: 30px;
        }

        .defect-results h2 {
            font-size: 24px;
            color: #2d3436;
            margin-bottom: 20px;
            text-align: center;
        }

        .defect-list {
            list-style: none;
        }

        .defect-item {
            background: white;
            border-left: 4px solid #4facfe;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .defect-item h4 {
            color: #e17055;
            margin-bottom: 5px;
        }

        .defect-item p {
            color: #636e72;
            margin: 0;
        }

        .error {
            color: #d63031;
            text-align: center;
            margin: 15px 0;
            font-size: 16px;
        }

        .back-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #6c5ce7;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .back-btn:hover {
            background: #5f4ae3;
        }

        .input-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #636e72;
            font-weight: 500;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .input-group textarea {
            height: 80px;
            resize: vertical;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>å»ºç­‘ç¼ºé™·æ™ºèƒ½æ£€æµ‹ç³»ç»Ÿ</h1>
        <p>ä¸Šä¼ å»ºç­‘å›¾ç‰‡ï¼ŒAIè‡ªåŠ¨è¯†åˆ«ç¼ºé™·å¹¶ç”Ÿæˆæ£€æµ‹æŠ¥å‘Š</p>
    </div>

    <div class="upload-section">
        <div class="upload-area" onclick="document.getElementById('imageUpload').click()">
            <div class="upload-icon">ğŸ“·</div>
            <div class="upload-text">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</div>
            <div class="upload-text">æ”¯æŒ JPGã€PNGã€JPEG æ ¼å¼ï¼Œæœ€å¤§ 10MB</div>
            <button class="upload-btn">é€‰æ‹©å›¾ç‰‡</button>
        </div>

        <form id="uploadForm" action="/upload-image" method="post" enctype="multipart/form-data">
            <input type="file" id="imageUpload" name="image" accept="image/*" style="display: none;" onchange="handleFileSelect(this)">
            <input type="hidden" id="defectLocation" name="defectLocation" value="">
            <input type="hidden" id="defectDescription" name="defectDescription" value="">
        </form>
    </div>

    <!-- æ·»åŠ ç¼ºé™·åœ°ç‚¹å’Œè¯¦ç»†æè¿°è¾“å…¥æ¡† -->
    <div class="input-section">
        <div class="input-group">
            <label for="defectLocationInput">ç¼ºé™·åœ°ç‚¹ *</label>
            <input type="text" id="defectLocationInput" placeholder="è¯·è¾“å…¥ç¼ºé™·å…·ä½“ä½ç½®" required>
        </div>
        <div class="input-group">
            <label for="defectDescriptionInput">è¯¦ç»†æè¿°</label>
            <textarea id="defectDescriptionInput" placeholder="è¯·è¾“å…¥ç¼ºé™·çš„è¯¦ç»†æè¿°ä¿¡æ¯"></textarea>
        </div>
    </div>

    <div th:if="${originalImagePath}" class="image-comparison">
        <div class="image-container">
            <h4>åŸå›¾</h4>
            <img th:src="@{${originalImagePath}}" alt="åŸå›¾">
        </div>
        <div class="image-container">
            <h4>å¤„ç†åå›¾ç‰‡</h4>
            <img th:src="@{${processedImagePath}}" alt="å¤„ç†åå›¾ç‰‡">
        </div>
    </div>

    <div th:if="${defects}" class="defect-results">
        <h2>æ£€æµ‹ç»“æœ - å‘ç° <span th:text="${defectCount}"></span> ä¸ªç¼ºé™·</h2>
        <ul class="defect-list">
            <li class="defect-item" th:each="defect : ${defects}">
                <h4>ç¼ºé™·ç±»å‹: [[${defect}]]</h4>
                <p>ä¸¥é‡ç¨‹åº¦: ä¸­ç­‰</p>
            </li>
        </ul>
    </div>

    <div th:if="${error}" class="error">
        <p th:text="${error}"></p>
    </div>

    <div style="text-align: center;">
        <a href="/index" class="back-btn">è¿”å›é¦–é¡µ</a>
    </div>
</div>

<script>
    function handleFileSelect(input) {
        if (input.files && input.files[0]) {
            // æ›´æ–°éšè—å­—æ®µçš„å€¼
            const locationInput = document.getElementById('defectLocationInput');
            const descriptionInput = document.getElementById('defectDescriptionInput');

            if (locationInput.value.trim() === '') {
                alert('è¯·è¾“å…¥ç¼ºé™·åœ°ç‚¹');
                return;
            }

            document.getElementById('defectLocation').value = locationInput.value;
            document.getElementById('defectDescription').value = descriptionInput.value;

            document.getElementById('uploadForm').submit();
        }
    }

    // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
    const uploadArea = document.querySelector('.upload-area');
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.style.borderColor = '#4facfe';
        this.style.backgroundColor = '#e3f2fd';
    });

    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.style.borderColor = '#ddd';
        this.style.backgroundColor = '#fafafa';
    });

    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        this.style.borderColor = '#ddd';
        this.style.backgroundColor = '#fafafa';

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const fileInput = document.getElementById('imageUpload');
            fileInput.files = files;

            // æ›´æ–°éšè—å­—æ®µçš„å€¼
            const locationInput = document.getElementById('defectLocationInput');
            const descriptionInput = document.getElementById('defectDescriptionInput');

            if (locationInput.value.trim() === '') {
                alert('è¯·è¾“å…¥ç¼ºé™·åœ°ç‚¹');
                return;
            }

            document.getElementById('defectLocation').value = locationInput.value;
            document.getElementById('defectDescription').value = descriptionInput.value;

            document.getElementById('uploadForm').submit();
        }
    });
</script>
</body>
</html>
